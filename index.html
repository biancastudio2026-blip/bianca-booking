<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Bianca_eye.studio é ç´„ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background-color: #fdfbf7; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
    .slide-up { animation: slideUp 0.3s ease-out; }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    // --- import å€å¡Š ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, arrayUnion, arrayRemove, onSnapshot, runTransaction, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- Firebase è¨­å®š ---
    const firebaseConfig = {
      apiKey: "AIzaSyDPCo-OifrWYwQ5B94sdxTvqOSy0Fasjr8",
      authDomain: "biancatemp-2e89e.firebaseapp.com",
      projectId: "biancatemp-2e89e",
      storageBucket: "biancatemp-2e89e.firebasestorage.app",
      messagingSenderId: "272754208042",
      appId: "1:272754208042:web:7ef2864c3bd7dacab8c253",
      measurementId: "G-6CTBV02QR4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const SCHEDULE_COLLECTION = 'bianca_schedule_data';
    const CLIENTS_COLLECTION = 'bianca_clients_data';

    // --- åœ–ç¤º (æ–°å¢ Plane, PenTool) ---
    const Icons = {
      Menu: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
      X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
      Instagram: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>,
      MessageCircle: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></svg>,
      ChevronDown: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>,
      ChevronUp: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>,
      Star: ({fill, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Heart: ({fill, ...p}) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
      Sparkles: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M3 7.5v-1"/></svg>,
      Calendar: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
      MapPin: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
      Clock: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Trash2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
      Plus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
      Lock: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      User: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      Ban: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>,
      Search: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      Send: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
      UserPlus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" x2="20" y1="8" y2="14"/><line x1="23" x2="17" y1="11" y2="11"/></svg>,
      Settings: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
      // [æ–°å¢] é£›æ©Ÿèˆ‡ç­†
      Plane: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h20"/><path d="M13 2l9 10-9 10"/><path d="M16 12V2"/><path d="M16 12v10"/><path d="M2 12l5-5"/><path d="M2 12l5 5"/></svg>, // æ›¿æ›ç‚ºæ›´åƒé£›æ©Ÿçš„åœ–ç¤º
      PlaneSimple: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h20"/><path d="m19 5-7 7-7-7"/></svg>, // é€™è£¡ç›´æ¥ä½¿ç”¨æ›´åƒé£›æ©Ÿçš„ path
      PlaneReal: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.2-1.1.7l-1.2 4 6 3.2-2 2-4-1.5L1 16l7.4 1.6c.7.1 1.4-.1 1.9-.4l4.1-2.3 2.7.9c.5.2 1 .2 1.3-.1l.3-.4c.3-.5.1-1.1-.4-1.5z"/></svg>,
      PenTool: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>
    };

    const DoodleEye = ({ className }) => (<svg viewBox="0 0 100 60" className={className} fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round"><path d="M10,40 Q50,10 90,40" /><path d="M20,28 L15,15" /><path d="M35,22 L32,8" /><path d="M50,20 L50,5" /><path d="M65,22 L68,8" /><path d="M80,28 L85,15" /></svg>);
    const SquiggleLine = ({ className }) => (<svg viewBox="0 0 100 20" className={className} fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round"><path d="M5,10 Q25,20 50,10 T95,10" /></svg>);
    const HandDrawnBorder = ({ children, className = "" }) => (<div className={`border-2 border-stone-400 bg-white p-6 shadow-sm ${className}`} style={{ borderRadius: "255px 15px 225px 15px / 15px 225px 15px 255px" }}>{children}</div>);

    // --- [æ–°å¢] é ç´„æŸ¥è©¢è¦–çª— ---
    const ReservationLookupModal = ({ isOpen, onClose }) => {
      const [searchKey, setSearchKey] = React.useState('');
      const [results, setResults] = React.useState([]);
      const [hasSearched, setHasSearched] = React.useState(false);
      const [loading, setLoading] = React.useState(false);

      const handleSearch = async () => {
        if (!searchKey) return;
        setLoading(true);
        setResults([]);
        try {
          const querySnapshot = await getDocs(collection(db, SCHEDULE_COLLECTION));
          const found = [];
          const now = new Date();
          const todayStr = now.toISOString().split('T')[0];

          querySnapshot.forEach(doc => {
            const date = doc.id;
            if (date < todayStr) return; 
            const data = doc.data();
            if (data.slots) {
              data.slots.forEach(slot => {
                if (slot.status === 'booked' && (slot.clientPhone === searchKey || slot.clientName === searchKey)) {
                  found.push({ date, ...slot });
                }
              });
            }
          });
          found.sort((a, b) => (a.date + a.time).localeCompare(b.date + b.time));
          setResults(found);
          setHasSearched(true);
        } catch (e) {
          alert("æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
          console.error(e);
        }
        setLoading(false);
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 z-[80] flex items-center justify-center p-4 modal-overlay" onClick={onClose}>
           <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl border-2 border-stone-200 slide-up" onClick={e => e.stopPropagation()}>
              <div className="flex justify-between items-center mb-4 border-b border-stone-100 pb-2">
                <h3 className="font-bold text-stone-700 text-lg flex items-center gap-2"><Icons.Search size={20} /> é ç´„æŸ¥è©¢</h3>
                <button onClick={onClose}><Icons.X className="text-stone-400" /></button>
              </div>
              <div className="space-y-4">
                 <div className="flex gap-2">
                   <input
                     type="text"
                     placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æˆ–å§“å"
                     value={searchKey}
                     onChange={e => setSearchKey(e.target.value)}
                     className="flex-1 border border-stone-200 rounded-lg p-2 text-sm outline-none focus:border-[#dcb5bc]"
                   />
                   <button onClick={handleSearch} disabled={loading} className="bg-[#dcb5bc] text-white px-4 rounded-lg font-bold">
                     {loading ? '...' : 'æŸ¥è©¢'}
                   </button>
                 </div>

                 <div className="max-h-[50vh] overflow-y-auto no-scrollbar space-y-3">
                    {hasSearched && results.length === 0 && <p className="text-center text-stone-400 text-sm">æŸ¥ç„¡é ç´„è³‡æ–™</p>}
                    {results.map((res, idx) => (
                      <div key={idx} className="bg-stone-50 border border-stone-200 rounded-xl p-3 relative overflow-hidden">
                         <div className="absolute top-0 left-0 w-1 h-full bg-[#dcb5bc]"></div>
                         <div className="pl-3">
                           <div className="flex justify-between items-baseline mb-1">
                             <span className="font-bold text-lg text-stone-700">{res.date}</span>
                             <span className="font-bold text-[#b07d88] text-lg">{res.time}</span>
                           </div>
                           <div className="text-sm text-stone-600 mb-1 flex items-center gap-1"><Icons.MapPin size={12}/> {res.location}</div>
                           <div className="text-xs text-stone-500 bg-white p-2 rounded-lg border border-stone-100">
                             {res.services || "é ç´„é …ç›® (èˆŠè³‡æ–™æœªé¡¯ç¤ºè©³ç´°é …ç›®)"}
                           </div>
                         </div>
                      </div>
                    ))}
                 </div>

                 <div className="bg-[#fff5f5] border border-red-100 p-3 rounded-xl flex items-start gap-3">
                    <div className="bg-red-400 rounded-full p-1 text-white shrink-0 mt-0.5">
                      <Icons.MessageCircle size={14} />
                    </div>
                    <div className="text-xs text-stone-600 leading-relaxed">
                       <span className="font-bold text-red-400 block mb-0.5">éœ€ä¿®æ”¹é ç´„ï¼Ÿ</span>
                       è‹¥éœ€è¦æ›´æ”¹é ç´„å…§å®¹æˆ–æ™‚é–“ï¼Œè«‹ç›´æ¥é€é LINE è¨Šæ¯<span className="font-bold text-stone-700">è“è“</span>åšä¿®æ”¹ï¼
                    </div>
                 </div>
                 <a href="https://lin.ee/49zZehk" target="_blank" className="block w-full text-center bg-[#06c755] text-white py-2 rounded-xl text-sm font-bold shadow-sm hover:opacity-90">
                   å‰å¾€ LINE å®˜æ–¹å¸³è™Ÿ
                 </a>
              </div>
           </div>
        </div>
      );
    }

    // --- é»‘åå–®ç®¡ç†è¦–çª— ---
    const BlacklistManagerModal = ({ isOpen, onClose, initialTab }) => {
      const [tab, setTab] = React.useState('list'); 
      const [blacklistClients, setBlacklistClients] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      
      const [newPhone, setNewPhone] = React.useState('');
      const [newName, setNewName] = React.useState('');
      const [newNote, setNewNote] = React.useState('');

      React.useEffect(() => {
        if (isOpen) {
          setTab(initialTab || 'list');
          fetchBlacklist();
        }
      }, [isOpen, initialTab]);

      const fetchBlacklist = async () => {
        setLoading(true);
        try {
          const q = query(collection(db, CLIENTS_COLLECTION), where("blacklist", "==", true));
          const querySnapshot = await getDocs(q);
          const list = [];
          querySnapshot.forEach((doc) => {
            list.push(doc.data());
          });
          setBlacklistClients(list);
        } catch (error) {
          console.error("Error fetching blacklist:", error);
          alert("è®€å–é»‘åå–®å¤±æ•—");
        }
        setLoading(false);
      };

      const handleRemoveBlacklist = async (phone) => {
        if (!confirm(`ç¢ºå®šè¦å°‡ ${phone} ç§»å‡ºé»‘åå–®å—ï¼Ÿ`)) return;
        try {
          const docRef = doc(db, CLIENTS_COLLECTION, phone);
          await updateDoc(docRef, { blacklist: false });
          setBlacklistClients(prev => prev.filter(c => c.phone !== phone));
          alert("å·²ç§»é™¤");
        } catch (e) {
          alert("ç§»é™¤å¤±æ•—: " + e.message);
        }
      };

      const handleAddBlacklist = async () => {
        if (!newPhone || newPhone.length !== 10) return alert("è«‹è¼¸å…¥æ­£ç¢ºçš„10ç¢¼é›»è©±è™Ÿç¢¼");
        if (!newName) return alert("è«‹è¼¸å…¥å§“å");

        try {
          const docRef = doc(db, CLIENTS_COLLECTION, newPhone);
          await setDoc(docRef, {
            phone: newPhone,
            name: newName,
            notes: newNote,
            blacklist: true,
            visitCount: 0 
          }, { merge: true }); 

          alert("å·²åŠ å…¥é»‘åå–®");
          setNewPhone(''); setNewName(''); setNewNote('');
          fetchBlacklist(); 
          setTab('list'); 
        } catch (e) {
          alert("åŠ å…¥å¤±æ•—: " + e.message);
        }
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 modal-overlay" onClick={onClose}>
          <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl border-2 border-stone-200 slide-up flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-4 border-b border-stone-100 pb-2">
              <h3 className="font-bold text-stone-700 text-lg flex items-center gap-2">
                <Icons.Ban className="text-red-500" /> é»‘åå–®ç®¡ç†
              </h3>
              <button onClick={onClose}><Icons.X className="text-stone-400" /></button>
            </div>

            <div className="flex gap-2 mb-4">
              <button onClick={() => setTab('list')} className={`flex-1 py-1 text-xs font-bold rounded-lg ${tab==='list'?'bg-stone-600 text-white':'bg-stone-100 text-stone-500'}`}>åå–®åˆ—è¡¨</button>
              <button onClick={() => setTab('add')} className={`flex-1 py-1 text-xs font-bold rounded-lg ${tab==='add'?'bg-red-500 text-white':'bg-stone-100 text-stone-500'}`}>æ–°å¢é»‘åå–®</button>
            </div>

            <div className="flex-1 overflow-y-auto no-scrollbar">
              {tab === 'list' ? (
                <div className="space-y-2">
                  {loading ? <p className="text-center text-xs text-stone-400">è¼‰å…¥ä¸­...</p> : blacklistClients.length === 0 ? <p className="text-center text-xs text-stone-400 py-4">ç›®å‰æ²’æœ‰é»‘åå–®</p> : 
                    blacklistClients.map(client => (
                      <div key={client.phone} className="bg-stone-50 p-3 rounded-lg border border-stone-200 flex justify-between items-center">
                        <div>
                          <div className="font-bold text-sm text-stone-700">{client.name}</div>
                          <div className="text-xs text-stone-500">{client.phone}</div>
                          {client.notes && <div className="text-[10px] text-red-400 mt-1">{client.notes}</div>}
                        </div>
                        <button onClick={() => handleRemoveBlacklist(client.phone)} className="text-stone-400 hover:text-red-500"><Icons.Trash2 size={16} /></button>
                      </div>
                    ))
                  }
                </div>
              ) : (
                <div className="space-y-3">
                  <div className="bg-red-50 p-3 rounded-lg text-xs text-red-500 mb-2">
                    åœ¨æ­¤æ–°å¢çš„é›»è©±å°‡æœƒç›´æ¥è¢«ç¦æ­¢é ç´„ã€‚
                  </div>
                  <input type="tel" placeholder="é›»è©±è™Ÿç¢¼ (09xxxxxxxx)" value={newPhone} onChange={e=>setNewPhone(e.target.value)} className="w-full border border-stone-200 rounded-lg p-2 text-sm outline-none" />
                  <input type="text" placeholder="å§“å" value={newName} onChange={e=>setNewName(e.target.value)} className="w-full border border-stone-200 rounded-lg p-2 text-sm outline-none" />
                  <textarea placeholder="å‚™è¨» (åŸå› )" value={newNote} onChange={e=>setNewNote(e.target.value)} className="w-full border border-stone-200 rounded-lg p-2 text-sm outline-none h-20" />
                  <button onClick={handleAddBlacklist} className="w-full bg-red-500 text-white py-2 rounded-lg font-bold shadow-md hover:bg-red-600">åŠ å…¥é»‘åå–®</button>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    // --- å®¢æˆ¶èˆ‡é ç´„é‚è¼¯ ---
    const BookingModal = ({ isOpen, onClose, slot, dateKey }) => {
      const [step, setStep] = React.useState(1);
      const [clientPhone, setClientPhone] = React.useState('');
      const [clientData, setClientData] = React.useState(null); 
      const [loading, setLoading] = React.useState(false);
      const [clientName, setClientName] = React.useState('');
      
      const [services, setServices] = React.useState({
        upper: false, upperTint: false,
        lower: false, lowerTint: false, brow: false
      });

      React.useEffect(() => {
        if(isOpen) {
          setStep(1); setClientPhone(''); setClientData(null);
          setClientName(''); 
          setServices({ upper: false, upperTint: false, lower: false, lowerTint: false, brow: false });
        }
      }, [isOpen]);

      if (!isOpen) return null;

      const checkClient = async () => {
        if(clientPhone.length !== 10) return alert("è«‹ç¢ºèªé›»è©±è™Ÿç¢¼æ˜¯å¦æœ‰èª¤~");
        
        setLoading(true);
        try {
          const docRef = doc(db, CLIENTS_COLLECTION, clientPhone);
          const docSnap = await getDoc(docRef);
          
          if (docSnap.exists()) {
            const data = docSnap.data();
            if (data.blacklist) {
              alert("æ‚¨æœ‰é ç´„æœªåˆ°çš„ç´€éŒ„, è«‹ç›´æ¥åˆ©ç”¨å®˜æ–¹Lineèˆ‡åº—å®¶è¯ç¹«~");
              window.location.href = "https://lin.ee/49zZehk";
              onClose();
              return;
            }
            setClientData({ ...data, status: 'old' });
            setClientName(data.name || '');
          } else {
            setClientData({ status: 'new' });
          }
          setStep(2);
        } catch (e) {
          console.error(e);
          alert("ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
        }
        setLoading(false);
      };

      const isNewClient = clientData?.status === 'new';
      
      const PRICES = {
        upper: isNewClient ? 699 : 999,
        brow: isNewClient ? 699 : 999,
        lower_single: 500,
        lower_combo: 300,
        tint_upper: 200,
        tint_lower: 100
      };

      let total = 0;
      if (services.upper) total += PRICES.upper;
      if (services.lower) total += (services.upper ? PRICES.lower_combo : PRICES.lower_single);
      if (services.brow) total += PRICES.brow;
      
      let comboDiscount = 0;
      if ((services.upper || services.lower) && services.brow) {
          comboDiscount = 100;
          total -= comboDiscount;
      }

      if (services.upperTint && services.upper) total += PRICES.tint_upper;
      if (services.lowerTint && services.lower) total += PRICES.tint_lower;

      let tintDiscount = 0;
      if (services.upperTint && services.lowerTint && services.upper && services.lower) {
        tintDiscount = 50;
        total -= tintDiscount;
      }

      const handleConfirm = async () => {
        if (!clientName) return alert("è«‹å¡«å¯«å§“åä»¥ä¾¿è¯ç¹«");

        const items = [];
        if (services.upper) items.push(`ä¸Šç«æ¯›ç®¡ç† ($${PRICES.upper})`);
        if (services.upperTint) items.push(`  + æ¿ƒé»‘é¤Šè­· ($${PRICES.tint_upper})`);
        if (services.lower) items.push(`ä¸‹ç«æ¯›ç®¡ç† ($${services.upper ? PRICES.lower_combo : PRICES.lower_single})`);
        if (services.lowerTint) items.push(`  + æ¿ƒé»‘é¤Šè­· ($${PRICES.tint_lower})`);
        if (services.brow) items.push(`é‡ç”Ÿçœ‰é›•å¡‘ ($${PRICES.brow})`);
        
        if ((services.upper || services.lower) && services.brow) items.push(`(çœ‰ç«åˆè³¼æŠ˜æŠµ -$100)`);
        if (services.upper && services.lower) items.push(`(ä¸Šä¸‹ç«æ¯›åˆè³¼æŠ˜æŠµ -$200)`);
        
        if (tintDiscount > 0) items.push(`(æ¿ƒé»‘é¤Šè­·åˆè³¼å„ªæƒ  -$50)`);

        if (!isNewClient) items.push(`(æ­¡è¿å›å¨˜å®¶â™¡)`);

        let extraInfo = '';
        if (slot.location.includes('æ–°ç«¹')) extraInfo = '\nåœ°å€ï¼š(è«‹å¡«å¯«è©³ç´°åœ°å€ï¼Œåˆ°åºœè²»$100-150è¦–è·é›¢å ±åƒ¹)';

        const text = `Hi Bianca, æˆ‘æƒ³é ç´„ï¼š\næ—¥æœŸï¼š${dateKey}\næ™‚é–“ï¼š${slot.time}\nåœ°é»ï¼š${slot.location}${extraInfo}\n\né ç´„é …ç›®ï¼š\n${items.join('\n')}\n\né ä¼°é‡‘é¡ï¼š$${total}\n\nå§“åï¼š${clientName}\né›»è©±ï¼š${clientPhone}\n\n*å‚™è¨»ï¼šç•¶å¤©è‹¥å¸¶å¦ï¼Œéœ€åŠ æ”¶$100å¸å¦è²»*`;

        let copySuccess = false;
        try {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; 
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            copySuccess = document.execCommand('copy');
            document.body.removeChild(textArea);
        } catch (e) {
            console.error("Copy failed", e);
        }

        try {
          await runTransaction(db, async (transaction) => {
            const scheduleRef = doc(db, SCHEDULE_COLLECTION, dateKey);
            const scheduleDoc = await transaction.get(scheduleRef);
            
            if (!scheduleDoc.exists()) throw new Error("è¡Œç¨‹è¡¨è³‡æ–™ä¸å­˜åœ¨");

            const slots = scheduleDoc.data().slots || [];
            
            const duplicateBooking = slots.find(s => 
              s.status === 'booked' && 
              s.clientName === clientName && 
              s.clientPhone === clientPhone
            );

            if (duplicateBooking) {
                throw new Error("DUPLICATE_BOOKING");
            }

            const targetSlotIndex = slots.findIndex(s => s.id === slot.id);

            if (targetSlotIndex === -1) throw new Error("æ‰¾ä¸åˆ°è©²æ™‚æ®µ");
            if (slots[targetSlotIndex].status !== 'open') throw new Error("æŠ±æ­‰ï¼è©²æ™‚æ®µå‰›å‰›è¢«å…¶ä»–äººæ¶å…ˆé ç´„äº† ğŸ˜­");

            slots[targetSlotIndex].status = 'booked';
            slots[targetSlotIndex].clientName = clientName;
            slots[targetSlotIndex].clientPhone = clientPhone;
            // [é‡è¦] å°‡æœå‹™é …ç›®æ–‡å­—å­˜å…¥ DBï¼Œæ–¹ä¾¿æŸ¥è©¢
            slots[targetSlotIndex].services = items.join(', ');

            transaction.update(scheduleRef, { slots: slots });

            const clientRef = doc(db, CLIENTS_COLLECTION, clientPhone);
            transaction.set(clientRef, {
              phone: clientPhone,
              name: clientName,
              lastVisit: dateKey,
              visitCount: (clientData?.visitCount || 0) + 1,
              blacklist: false
            }, { merge: true });
          });

          if (copySuccess) {
              alert("ğŸ‰ é ç´„è³‡è¨Šå·²è¤‡è£½ï¼\n\nâš ï¸ é‡è¦æé†’ï¼š\nå³å°‡è·³è½‰è‡³ LINEï¼Œè«‹å‹™å¿…åœ¨å°è©±æ¡†ç›´æ¥ã€Œè²¼ä¸Šã€ä¸¦ã€Œå‚³é€ã€è¨Šæ¯ï¼Œæ‰ç®—çœŸæ­£å®Œæˆé ç´„å–”ï¼");
          } else {
              alert("é ç´„æˆåŠŸï¼æ™‚æ®µå·²ç‚ºæ‚¨ä¿ç•™ã€‚\n(è‡ªå‹•è¤‡è£½å¤±æ•—) è«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹å‚³é€çµ¦ LINE å®¢æœï¼š\n\n" + text);
          }

          window.location.href = "https://lin.ee/49zZehk";
          
          setTimeout(() => {
             onClose();
          }, 500);

        } catch (e) {
          if (e.message === "DUPLICATE_BOOKING") {
              alert("æ‚¨å·²é ç´„ä¸åŒæ™‚æ®µ, è«‹ç›´æ¥ä½¿ç”¨Lineå‘Biancaå®˜æ–¹è¯ç¹«");
              onClose();
              return;
          }

          alert("é ç´„å¤±æ•—ï¼š" + e.message);
          if (e.message.includes("æ¶å…ˆ")) {
             onClose();
          }
        }
      };

      return (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 modal-overlay" onClick={onClose}>
          <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl border-2 border-stone-200 slide-up" onClick={e => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-4">
              <h3 className="font-bold text-stone-700 text-lg">
                {step === 1 ? 'æœƒå“¡é©—è­‰' : (isNewClient ? 'âœ¨ æ–°å®¢é«”é©—é ç´„' : 'â¤ï¸ VIP å›è¨ªé ç´„')}
              </h3>
              <button onClick={onClose}><Icons.X className="text-stone-400" /></button>
            </div>
            
            {step === 1 ? (
              <div className="space-y-4">
                <p className="text-sm text-stone-500">è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼ï¼Œç³»çµ±å°‡è‡ªå‹•æŸ¥è©¢æ˜¯å¦äº«æœ‰æ–°å®¢é«”é©—åƒ¹ã€‚</p>
                <input 
                  type="tel" 
                  value={clientPhone}
                  onChange={e => setClientPhone(e.target.value)}
                  placeholder="09xxxxxxxx"
                  className="w-full border-2 border-stone-200 rounded-xl p-3 text-lg outline-none focus:border-[#dcb5bc]"
                />
                <button 
                  onClick={checkClient} 
                  disabled={loading}
                  className="w-full bg-[#dcb5bc] text-white py-3 rounded-xl font-bold shadow-md hover:opacity-90 transition disabled:opacity-50"
                >
                  {loading ? 'æŸ¥è©¢ä¸­...' : 'ä¸‹ä¸€æ­¥'}
                </button>
              </div>
            ) : (
              <div className="space-y-3 mb-6 max-h-[60vh] overflow-y-auto no-scrollbar">
                
                <div className="mb-2">
                  <input type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" value={clientName} onChange={e=>setClientName(e.target.value)} className="w-full border-2 border-stone-200 rounded-lg p-2 text-sm outline-none focus:border-[#dcb5bc]" />
                </div>

                <div className="border border-stone-200 rounded-xl p-3">
                  <label className="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" checked={services.upper} onChange={() => setServices(p => ({...p, upper: !p.upper, upperTint: !p.upper ? false : p.upperTint}))} className="w-5 h-5 accent-[#dcb5bc]" />
                    <span className="font-bold text-stone-600">ä¸Šç«æ¯›ç®¡ç† <span className="text-[#b07d88]">${PRICES.upper}</span></span>
                  </label>
                  {services.upper && (
                    <div className="ml-8 mt-2 pt-2 border-t border-dashed border-stone-100">
                      <label className="flex items-center gap-2 cursor-pointer text-sm text-stone-500">
                        <input type="checkbox" checked={services.upperTint} onChange={() => setServices(p => ({...p, upperTint: !p.upperTint}))} className="accent-[#dcb5bc]" />
                        + åŠ è³¼æ¿ƒé»‘é¤Šè­· ($200)
                      </label>
                    </div>
                  )}
                </div>

                <div className="border border-stone-200 rounded-xl p-3">
                  <label className="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" checked={services.lower} onChange={() => setServices(p => ({...p, lower: !p.lower, lowerTint: !p.lower ? false : p.lowerTint}))} className="w-5 h-5 accent-[#dcb5bc]" />
                    <div className="flex flex-col">
                      <span className="font-bold text-stone-600">ä¸‹ç«æ¯›ç®¡ç†</span>
                      <span className="text-xs text-stone-400">å–®ä½œ$500 / æ­é…ä¸Šç«æ¯›å„ªæƒ  <span className="text-[#b07d88] font-bold">$300</span></span>
                    </div>
                  </label>
                  {services.lower && (
                    <div className="ml-8 mt-2 pt-2 border-t border-dashed border-stone-100">
                      <label className="flex items-center gap-2 cursor-pointer text-sm text-stone-500">
                        <input type="checkbox" checked={services.lowerTint} onChange={() => setServices(p => ({...p, lowerTint: !p.lowerTint}))} className="accent-[#dcb5bc]" />
                        + åŠ è³¼æ¿ƒé»‘é¤Šè­· ($100)
                      </label>
                    </div>
                  )}
                </div>

                <div className="border border-stone-200 rounded-xl p-3">
                  <label className="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" checked={services.brow} onChange={() => setServices(p => ({...p, brow: !p.brow}))} className="w-5 h-5 accent-[#dcb5bc]" />
                    <div className="flex flex-col">
                      <span className="font-bold text-stone-600">é‡ç”Ÿçœ‰é›•å¡‘ <span className="text-[#b07d88]">${PRICES.brow}</span></span>
                      {(services.upper || services.lower) && <span className="text-xs text-[#b07d88] font-bold">âœ¨ èˆ‡ä»»ä¸€ç«æ¯›ç®¡ç†åˆè³¼å†æŠ˜ $100</span>}
                    </div>
                  </label>
                </div>

                <div className="text-xs text-red-400 bg-red-50 p-2 rounded-lg text-center">
                  âš ï¸ æé†’ï¼šç•¶å¤©è‹¥å¸¶å¦åˆ°ï¼Œéœ€åŠ æ”¶ $100 å¸å¦è²»
                </div>

                <div className="bg-[#fae8eb] p-4 rounded-xl flex flex-col gap-1">
                  <div className="flex justify-between items-center">
                    <span className="text-stone-600 font-bold text-sm">é ä¼°é‡‘é¡</span>
                    <span className="text-[#b07d88] font-bold text-xl">${total}</span>
                  </div>
                  {/* [æ–°å¢] å„ªæƒ æç¤º */}
                  {comboDiscount > 0 && <span className="text-xs text-[#b07d88] text-right">å·²æ‰£é™¤ç«æ¯›ç®¡ç†èˆ‡é‡ç”Ÿçœ‰åˆè³¼å„ªæƒ  -$100</span>}
                  
                  {/* [æ–°å¢] ä¸Šä¸‹ç«æ¯›åˆè³¼å„ªæƒ æç¤º */}
                  {(services.upper && services.lower) && <span className="text-xs text-[#b07d88] text-right">å·²æ‰£é™¤ä¸Š/ ä¸‹ç«æ¯›ç®¡ç†åˆè³¼å„ªæƒ  -$200</span>}

                  {tintDiscount > 0 && <span className="text-xs text-[#b07d88] text-right">å·²æ‰£é™¤æ¿ƒé»‘é¤Šè­·åˆè³¼å„ªæƒ  -$50</span>}
                </div>

                <button onClick={handleConfirm} disabled={total === 0} className="w-full bg-[#dcb5bc] text-white py-3 rounded-xl font-bold shadow-md hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                  ç¢ºèªé ç´„ï¼Œå‰å¾€ LINE
                </button>
              </div>
            )}
          </div>
        </div>
      );
    };

    // --- ç®¡ç†è€…å¾Œå°çµ„ä»¶ ---
    const AdminPanel = ({ selectedDateKey, newTime, setNewTime, newLocation, setNewLocation, addSlot }) => {
      const [view, setView] = React.useState('booking'); 
      const [phoneSearch, setPhoneSearch] = React.useState('');
      const [searchResult, setSearchResult] = React.useState(null);
      const [showBlacklistManager, setShowBlacklistManager] = React.useState(false);
      const [blacklistManagerTab, setBlacklistManagerTab] = React.useState('list');

      // ç§»é™¤ locations é™£åˆ—ï¼Œæ”¹ç”¨æŒ‰éˆ•è§¸ç™¼
      
      const searchClient = async () => {
        if(!phoneSearch) return;
        try {
          const docRef = doc(db, CLIENTS_COLLECTION, phoneSearch);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) setSearchResult(docSnap.data());
          else setSearchResult('not_found');
        } catch(e) { alert(e.message); }
      };

      const toggleBlacklist = async () => {
        if(!searchResult || searchResult === 'not_found') return;
        try {
          await updateDoc(doc(db, CLIENTS_COLLECTION, searchResult.phone), {
            blacklist: !searchResult.blacklist
          });
          setSearchResult(prev => ({...prev, blacklist: !prev.blacklist}));
        } catch(e) { alert(e.message); }
      };

      const saveNote = async (note) => {
        try {
          await updateDoc(doc(db, CLIENTS_COLLECTION, searchResult.phone), { notes: note });
          alert("å‚™è¨»å·²å„²å­˜");
        } catch(e) { alert(e.message); }
      };

      const openBlacklistAdd = () => {
        setBlacklistManagerTab('add');
        setShowBlacklistManager(true);
      };

      const openBlacklistSettings = () => {
        setBlacklistManagerTab('list');
        setShowBlacklistManager(true);
      };

      // --- æ–°å¢ï¼šæ·¡æ°´ä¸€éµæ’ç­ ---
      const setTamsuiSchedule = async () => {
        if (!confirm(`ç¢ºå®šè¦è¨­å®š ${selectedDateKey} ç‚ºæ·¡æ°´ç­è¡¨å—ï¼Ÿ(å°‡è¦†è“‹ç•¶æ—¥èˆŠè¨­å®š)`)) return;
        const slots = ['09:30', '13:00', '15:30', '19:00'].map(time => ({
          id: Date.now().toString() + time.replace(':', ''),
          time,
          location: 'æ·¡æ°´è‡ªå®…',
          status: 'open'
        }));
        try {
          await setDoc(doc(db, SCHEDULE_COLLECTION, selectedDateKey), { slots: slots });
          alert("æ·¡æ°´ç­è¡¨å·²è¨­å®šå®Œæˆ");
        } catch (e) { alert(e.message); }
      };

      // --- æ–°å¢ï¼šç«¹åŒ— (å”èª¿æ¨¡å¼) ---
      const setZhubeiSchedule = async () => {
        if (!confirm(`ç¢ºå®šè¦è¨­å®š ${selectedDateKey} ç‚ºç«¹åŒ—(éœ€å”èª¿)å—ï¼Ÿ(å°‡è¦†è“‹ç•¶æ—¥èˆŠè¨­å®š)`)) return;
        // å»ºç«‹ä¸€å€‹ç‰¹æ®Šçš„ slotï¼Œæ™‚é–“é¡¯ç¤ºç‚º "æ™‚æ®µå”èª¿"
        const slots = [{
          id: Date.now().toString(),
          time: 'æ™‚æ®µå”èª¿',
          location: 'ç«¹åŒ—è‡ªå®…',
          status: 'open',
          type: 'zhubei_notice' // æ¨™è¨˜ç‚ºç‰¹æ®Šé¡å‹
        }];
        try {
          await setDoc(doc(db, SCHEDULE_COLLECTION, selectedDateKey), { slots: slots });
          alert("ç«¹åŒ—æ¨¡å¼å·²è¨­å®š");
        } catch (e) { alert(e.message); }
      };

      // --- [æ–°å¢] è¨­å®šç‰¹æ®Šç‹€æ…‹ (å‡ºåœ‹ã€ä¼‘æ¯ã€é€²ä¿®) ---
      const setSpecialStatus = async (type) => {
        let label = '';
        if (type === 'abroad') label = 'å‡ºåœ‹';
        if (type === 'rest') label = 'ä¼‘æ¯';
        if (type === 'training') label = 'é€²ä¿®';

        if (!confirm(`ç¢ºå®šè¦å°‡ ${selectedDateKey} è¨­å®šç‚ºã€${label}ã€‘å—ï¼Ÿ(å°‡è¦†è“‹ç•¶æ—¥èˆŠè¨­å®š)`)) return;

        const slots = [{
          id: Date.now().toString(),
          time: 'å…¨æ—¥',
          location: '',
          status: 'closed', // è¨­ç‚ºé—œé–‰
          type: type // æ¨™è¨˜ç‰¹æ®Šé¡å‹
        }];

        try {
          await setDoc(doc(db, SCHEDULE_COLLECTION, selectedDateKey), { slots: slots });
          alert(`å·²è¨­å®šç‚º ${label}`);
        } catch (e) { alert(e.message); }
      };

      return (
        <div className="mb-6 bg-white p-3 rounded-xl border border-stone-200 shadow-sm">
          <div className="flex gap-2 mb-4 border-b border-stone-100 pb-2">
            <button onClick={() => setView('booking')} className={`flex-1 py-1 text-xs font-bold rounded-lg ${view==='booking'?'bg-[#dcb5bc] text-white':'text-stone-400'}`}>æ’ç¨‹ç®¡ç†</button>
            <button onClick={() => setView('clients')} className={`flex-1 py-1 text-xs font-bold rounded-lg ${view==='clients'?'bg-[#dcb5bc] text-white':'text-stone-400'}`}>å®¢æˆ¶ç®¡ç† (é»‘åå–®)</button>
          </div>
          {view === 'booking' ? (
            <div className="flex flex-col gap-3">
              <div className="text-xs text-center text-stone-400 mb-1">è¨­å®š {selectedDateKey} çš„æ™‚æ®µ</div>
              
              {/* æ”¹ç‰ˆå¾Œçš„æ’ç­æŒ‰éˆ• */}
              <div className="grid grid-cols-2 gap-3">
                <button onClick={setTamsuiSchedule} className="bg-blue-50 text-blue-600 py-3 rounded-xl text-sm font-bold border border-blue-100 shadow-sm hover:bg-blue-100 transition flex flex-col items-center justify-center gap-1">
                  <span>ğŸŒŠ æ·¡æ°´è‡ªå®…</span>
                  <span className="text-[10px] font-normal opacity-70">09:30/13:00/15:30/19:00</span>
                </button>
                <button onClick={setZhubeiSchedule} className="bg-orange-50 text-orange-600 py-3 rounded-xl text-sm font-bold border border-orange-100 shadow-sm hover:bg-orange-100 transition flex flex-col items-center justify-center gap-1">
                  <span>ğŸ‹ ç«¹åŒ—è‡ªå®…</span>
                  <span className="text-[10px] font-normal opacity-70">é¡¯ç¤ºã€Œéœ€ç§è¨Šå”èª¿ã€</span>
                </button>
              </div>

              {/* [æ–°å¢] ç‰¹æ®Šç‹€æ…‹æŒ‰éˆ•å€ */}
              <div className="pt-2 border-t border-dashed border-stone-200">
                 <div className="text-[10px] text-stone-400 mb-1">ğŸ“… ä¼‘å‡/ç‰¹æ®Šæ’ç¨‹</div>
                 <div className="flex gap-2">
                    <button onClick={() => setSpecialStatus('abroad')} className="flex-1 bg-stone-100 text-stone-600 py-2 rounded-lg text-xs font-bold hover:bg-stone-200 flex items-center justify-center gap-1"><Icons.PlaneSimple size={14}/> å‡ºåœ‹</button>
                    <button onClick={() => setSpecialStatus('rest')} className="flex-1 bg-red-50 text-red-500 py-2 rounded-lg text-xs font-bold hover:bg-red-100">ä¼‘æ¯</button>
                    <button onClick={() => setSpecialStatus('training')} className="flex-1 bg-indigo-50 text-indigo-500 py-2 rounded-lg text-xs font-bold hover:bg-indigo-100 flex items-center justify-center gap-1"><Icons.PenTool size={14}/> é€²ä¿®</button>
                 </div>
              </div>

              {/* ä¿ç•™æ‰‹å‹•æ–°å¢ (æ‘ºç–Šæˆ–æ”¾åœ¨ä¸‹æ–¹ï¼Œé€™è£¡ç°¡åŒ–ä¿ç•™åŠŸèƒ½ä½†ç¸®å°é¡¯ç¤º) */}
              <div className="pt-2 border-t border-dashed border-stone-200">
                 <div className="text-[10px] text-stone-400 mb-1">æ‰‹å‹•æ–°å¢å€‹åˆ¥æ™‚æ®µ (ç‰¹æ®Šéœ€æ±‚ç”¨)</div>
                 <div className="flex gap-2">
                    <select value={newLocation} onChange={(e) => setNewLocation(e.target.value)} className="w-1/3 bg-stone-50 border border-stone-200 rounded-lg text-xs p-1 outline-none">
                      <option value="æ·¡æ°´è‡ªå®…">æ·¡æ°´</option>
                      <option value="ç«¹åŒ—è‡ªå®…">ç«¹åŒ—</option>
                    </select>
                    <input type="time" value={newTime} onChange={(e) => setNewTime(e.target.value)} className="w-1/3 bg-stone-50 border border-stone-200 rounded-lg text-xs p-1 outline-none" />
                    <button onClick={addSlot} className="flex-1 bg-stone-500 text-white rounded-lg text-xs font-bold"><Icons.Plus size={14} className="inline"/> æ–°å¢</button>
                 </div>
              </div>
            </div>
          ) : (
            <div className="space-y-3">
              <div className="flex gap-2">
                <input type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" value={phoneSearch} onChange={e=>setPhoneSearch(e.target.value)} className="flex-1 border border-stone-200 rounded-lg p-2 text-sm outline-none"/>
                <button onClick={searchClient} className="bg-stone-500 text-white px-2 rounded-lg"><Icons.Search size={16}/></button>
                <button onClick={openBlacklistAdd} className="bg-red-400 text-white px-2 rounded-lg" title="æ–°å¢é»‘åå–®"><Icons.UserPlus size={16}/></button>
                <button onClick={openBlacklistSettings} className="bg-stone-600 text-white px-2 rounded-lg" title="ç®¡ç†é»‘åå–®"><Icons.Settings size={16}/></button>
              </div>
              
              {searchResult === 'not_found' && <div className="text-xs text-center text-stone-400">æŸ¥ç„¡æ­¤å®¢æˆ¶è³‡æ–™</div>}
              {searchResult && searchResult !== 'not_found' && (
                <div className="bg-stone-50 p-3 rounded-lg text-sm">
                  <div className="flex justify-between items-center mb-2">
                    <span className="font-bold text-lg">{searchResult.name}</span>
                    {searchResult.blacklist && <span className="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full">é»‘åå–®</span>}
                  </div>
                  <div className="text-stone-500 text-xs mb-2">
                    ä¾†è¨ªæ¬¡æ•¸: {searchResult.visitCount || 0}
                  </div>
                  <textarea placeholder="å‚™è¨» (ä¾‹å¦‚: é ç´„æœªåˆ°...)" defaultValue={searchResult.notes || ''} onBlur={(e)=>saveNote(e.target.value)} className="w-full border border-stone-200 rounded p-1 text-xs mb-2 h-16"></textarea>
                  <button onClick={toggleBlacklist} className={`w-full py-1 rounded text-xs font-bold ${searchResult.blacklist ? 'bg-gray-200 text-stone-600' : 'bg-red-100 text-red-500'}`}>
                    {searchResult.blacklist ? 'è§£é™¤é»‘åå–®' : 'åŠ å…¥é»‘åå–®'}
                  </button>
                </div>
              )}
            </div>
          )}
          <BlacklistManagerModal isOpen={showBlacklistManager} onClose={()=>setShowBlacklistManager(false)} initialTab={blacklistManagerTab} />
        </div>
      );
    };

    // --- æ—¥æ›†çµ„ä»¶ (åŒ…å«é ç´„åˆ—è¡¨èˆ‡æé†’) ---
    const CalendarView = ({ isAdmin, user }) => {
      const [currentDate, setCurrentDate] = React.useState(new Date());
      const [selectedDate, setSelectedDate] = React.useState(new Date());
      const [availability, setAvailability] = React.useState({});
      const [bookedList, setBookedList] = React.useState([]);
      const [loading, setLoading] = React.useState(true);
      const [newTime, setNewTime] = React.useState('10:00');
      const [newLocation, setNewLocation] = React.useState('æ·¡æ°´è‡ªå®…'); // é è¨­æ”¹ç‚ºæ·¡æ°´
      const [modalOpen, setModalOpen] = React.useState(false);
      const [selectedSlot, setSelectedSlot] = React.useState(null);
      const locationColors = { 'æ–°ç«¹åœ°å€åˆ°åºœ': 'bg-red-400', 'æ–°ç«¹åˆ°åºœåœ°å€': 'bg-red-400', 'ç«¹åŒ—è‡ªå®…': 'bg-yellow-400', 'æ·¡æ°´è‡ªå®…': 'bg-green-400' };
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDayOfMonth = new Date(year, month, 1).getDay();
      const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
      const formatDateKey = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const selectedDateKey = formatDateKey(selectedDate);

      React.useEffect(() => {
        const unsubscribe = onSnapshot(collection(db, SCHEDULE_COLLECTION), (snapshot) => {
          const data = {};
          const allBooked = [];
          snapshot.forEach(doc => {
            const slots = doc.data().slots || [];
            data[doc.id] = slots;
            slots.forEach(slot => { if (slot.status === 'booked') allBooked.push({ date: doc.id, ...slot }); });
          });
          setAvailability(data);
          setBookedList(allBooked.sort((a,b) => (a.date + a.time).localeCompare(b.date + b.time)));
          setLoading(false);
        });
        return () => unsubscribe();
      }, [user]);

      const addSlot = async () => {
        const slotData = { id: Date.now().toString(), time: newTime, location: newLocation, status: 'open' };
        try { await setDoc(doc(db, SCHEDULE_COLLECTION, selectedDateKey), { slots: arrayUnion(slotData) }, { merge: true }); } catch (e) { alert(e.message); }
      };

      const updateSlotStatus = async (slot, newStatus, clientName = '') => {
        try {
          const docRef = doc(db, SCHEDULE_COLLECTION, selectedDateKey);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            const updatedSlots = docSnap.data().slots.map(s => s.id === slot.id ? { ...s, status: newStatus, clientName } : s);
            await setDoc(docRef, { slots: updatedSlots });
          }
        } catch (e) { console.error(e); }
      };

      const removeSlot = async (slot) => {
        try { await updateDoc(doc(db, SCHEDULE_COLLECTION, selectedDateKey), { slots: arrayRemove(slot) }); } catch (e) { console.error(e); }
      };

      // [ä¿®æ”¹] è™•ç†ä½¿ç”¨è€…é»æ“Šï¼šå¦‚æœæ˜¯ç«¹åŒ—å”èª¿æ™‚æ®µæˆ–è™›æ“¬æ™‚æ®µï¼Œç›´æ¥è·³è­¦å‘Š
      const handleUserClick = (slot) => { 
        // æª¢æŸ¥ç‰¹æ®Šç‹€æ…‹ (ä¸é–‹æ”¾é ç´„)
        if (slot.type === 'abroad' || slot.type === 'rest' || slot.type === 'training') {
           return; // ä¸åšä»»ä½•åæ‡‰ï¼Œæˆ–å¯ alert("æœ¬æ—¥ä¼‘æ¯")
        }

        // åˆ¤æ–·æ˜¯å¦ç‚ºè™›æ“¬æ™‚æ®µ(isVirtual) æˆ– é¡¯å¼çš„ç«¹åŒ—å”èª¿æ™‚æ®µ
        if (slot.isVirtual || slot.type === 'zhubei_notice' || slot.time === 'æ™‚æ®µå”èª¿' || slot.location === 'ç«¹åŒ—è‡ªå®…') {
           alert("è“è“å› ç›®å‰ä»æœ‰æ­£è·å·¥ä½œï¼Œé ˆå”èª¿é ç´„æ™‚é–“!è«‹åŠ LINEåšè¨è«–ï¼Œè¬è¬");
           window.location.href = "https://lin.ee/49zZehk";
           return;
        }
        setSelectedSlot(slot); 
        setModalOpen(true); 
      };

      const handleAdminBook = (slot) => { const name = prompt("è«‹è¼¸å…¥é ç´„å®¢äººå§“åï¼š"); if (name) updateSlotStatus(slot, 'booked', name); };
      const changeMonth = (offset) => setCurrentDate(new Date(year, month + offset, 1));
      
      const sendLineReminder = (slot) => {
        const msg = `Hi ${slot.clientName}ï¼Œæé†’æ‚¨æ˜å¤© ${slot.date} ${slot.time} åœ¨ ${slot.location} æœ‰é ç´„å–”ï¼\nè‹¥éœ€æ›´æ”¹æ™‚é–“è«‹æå‰å‘ŠçŸ¥ï¼Œè¬è¬â¤ï¸\n(ç•¶å¤©è‹¥å¸¶å¦éœ€åŠ æ”¶$100å¸å¦è²»)`;
        const textArea = document.createElement("textarea");
        textArea.value = msg;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert("æé†’è¨Šæ¯å·²è¤‡è£½ï¼å°‡é–‹å•Ÿ LINE");
        window.location.href = "https://lin.ee/49zZehk";
      };

      // [æ–°å¢] åŠ å…¥ Google è¡Œäº‹æ›† (ç§»é™¤æ‰‹æ©Ÿä¸‹è¼‰æŒ‰éˆ•ï¼Œåªç•™ Google)
      const addToGoogleCalendar = (slot) => {
        // ... (Google Calendar logic same as before)
        const startStr = slot.date.replace(/-/g, '') + 'T' + (slot.time === 'æ™‚æ®µå”èª¿' || slot.time === 'å…¨æ—¥å¯ç´„' ? '090000' : slot.time.replace(':', '') + '00');
        // ... simple date logic ...
        const dateObj = new Date(`${slot.date}T${(slot.time === 'æ™‚æ®µå”èª¿' || slot.time === 'å…¨æ—¥å¯ç´„') ? '09:00' : slot.time}:00`);
        dateObj.setMinutes(dateObj.getMinutes() + 150);
        const endHours = String(dateObj.getHours()).padStart(2, '0');
        const endMinutes = String(dateObj.getMinutes()).padStart(2, '0');
        const endStr = slot.date.replace(/-/g, '') + 'T' + endHours + endMinutes + '00';
        
        const text = encodeURIComponent(`é ç´„: ${slot.clientName || 'å®¢æˆ¶'}`);
        const details = encodeURIComponent(`é›»è©±: ${slot.clientPhone || ''}\né …ç›®: ${slot.services || ''}`);
        const location = encodeURIComponent(slot.location || '');
        
        const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${startStr}/${endStr}&details=${details}&location=${location}`;
        window.open(url, '_blank');
      };

      return (
        <div className="w-full">
           <div className="flex justify-between items-center mb-4 px-2">
             <button onClick={() => changeMonth(-1)} className="p-1 hover:bg-stone-100 rounded-full"><Icons.ChevronDown className="rotate-90 text-stone-500" /></button>
             <h3 className="text-lg font-bold text-stone-700">{year}å¹´ {monthNames[month]}</h3>
             <button onClick={() => changeMonth(1)} className="p-1 hover:bg-stone-100 rounded-full"><Icons.ChevronDown className="-rotate-90 text-stone-500" /></button>
           </div>
           
           {/* [ä¿®æ”¹] åœ–ä¾‹ï¼šåªç•™ æ·¡æ°´(è—) å’Œ ç«¹åŒ—(é»ƒ) */}
           <div className="flex flex-wrap justify-center gap-x-4 gap-y-2 mb-4 text-[10px] text-stone-500">
              <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-blue-400"></span>æ·¡æ°´è‡ªå®…</div>
              <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-yellow-400"></span>ç«¹åŒ—è‡ªå®… (éœ€å”èª¿)</div>
           </div>

           <div className="grid grid-cols-7 gap-1 mb-6 text-center">
             {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(d => <div key={d} className="text-xs text-[#b07d88] font-bold mb-2">{d}</div>)}
             {Array.from({ length: firstDayOfMonth }).map((_, i) => <div key={`empty-${i}`} className="aspect-square"></div>)}
             {Array.from({ length: daysInMonth }).map((_, i) => {
               const d = i + 1;
               const dateObj = new Date(year, month, d);
               const dateKey = formatDateKey(dateObj);
               const isSelected = selectedDate.getDate() === d && selectedDate.getMonth() === month;
               const today = new Date();
               today.setHours(0,0,0,0);
               const isPast = dateObj < today;
               
               // [é‚è¼¯æ ¸å¿ƒä¿®æ”¹]
               const dateSlots = availability[dateKey] || [];
               
               // æª¢æŸ¥ç‰¹æ®Šç‹€æ…‹
               const specialSlot = dateSlots.find(s => ['abroad', 'rest', 'training'].includes(s.type));
               
               const hasSpecificSlots = dateSlots.length > 0; 
               const isZhubeiDefault = !hasSpecificSlots; 
               
               // Full logic: Only for specific slots (Tamsui). If Zhubei (default), it's never "full" in the system sense (unless manually blocked, but here it's open)
               // Also check if not special status
               const isFull = hasSpecificSlots && !specialSlot && !dateSlots.some(s => s.status === 'open');

               return (
                 <button key={d} onClick={() => setSelectedDate(dateObj)} disabled={isPast || !!specialSlot}
                   className={`aspect-square rounded-full flex flex-col items-center justify-center relative transition ${isSelected ? 'bg-[#dcb5bc] text-white shadow-md' : 'hover:bg-stone-100 text-stone-600'} ${isPast ? 'opacity-50 cursor-not-allowed' : ''} ${specialSlot ? 'cursor-not-allowed' : ''}`}
                 >
                   <span className={`text-sm font-medium relative`}>{d}</span>
                   
                   {/* ç‡ˆè™Ÿé¡¯ç¤ºé‚è¼¯ (ç„¡ç‰¹æ®Šç‹€æ…‹æ‰é¡¯ç¤ºç‡ˆè™Ÿ) */}
                   {!isPast && !specialSlot && (
                       <div className="absolute bottom-1.5 flex gap-0.5">
                          {hasSpecificSlots ? (
                              <span className="w-1.5 h-1.5 rounded-full bg-blue-400 ring-1 ring-white" />
                          ) : (
                              <span className="w-1.5 h-1.5 rounded-full bg-yellow-400 ring-1 ring-white" />
                          )}
                       </div>
                   )}

                   {/* Past Overlay */}
                   {isPast && (
                        <div className="absolute inset-0 flex items-center justify-center bg-stone-100/50 rounded-full">
                            <span className="text-stone-400 font-bold text-lg">âœ•</span>
                        </div>
                   )}

                   {/* [æ–°å¢] Special Status Overlay */}
                   {!isPast && specialSlot && (
                     <div className="absolute inset-0 flex items-center justify-center rounded-full bg-white/80">
                       {specialSlot.type === 'abroad' && <Icons.PlaneReal className="text-stone-500 w-5 h-5" />}
                       {specialSlot.type === 'rest' && <span className="text-red-500/80 font-bold text-sm">ä¼‘</span>}
                       {specialSlot.type === 'training' && <Icons.PenTool className="text-indigo-500 w-4 h-4" />}
                     </div>
                   )}

                   {/* Full Overlay (å„ªå…ˆæ¬Šä½æ–¼ç‰¹æ®Šç‹€æ…‹) */}
                   {!isPast && !specialSlot && isFull && (
                        <div className="absolute inset-0 flex items-center justify-center bg-white/60 rounded-full">
                            <span className="text-red-500 font-bold text-sm">æ»¿</span>
                        </div>
                   )}
                 </button>
               );
             })}
           </div>
           
           <div className="bg-[#fdfbf7] border-t-2 border-dashed border-stone-200 pt-4">
             <div className="text-center mb-4"><span className="bg-stone-200 text-stone-600 px-3 py-1 rounded-full text-xs font-bold">{selectedDateKey}</span></div>
             {isAdmin && <AdminPanel selectedDateKey={selectedDateKey} newTime={newTime} setNewTime={setNewTime} newLocation={newLocation} setNewLocation={setNewLocation} addSlot={addSlot} />}
             <div className="space-y-2">
               {loading ? <p className="text-center text-stone-400 text-sm">è¼‰å…¥ä¸­...</p> : 
                 /* [é‚è¼¯æ ¸å¿ƒä¿®æ”¹] åˆ—è¡¨é¡¯ç¤º */
                 (() => {
                    const currentSlots = availability[selectedDateKey] || [];
                    const specialSlot = currentSlots.find(s => ['abroad', 'rest', 'training'].includes(s.type));

                    // 1. å¦‚æœæ˜¯ç‰¹æ®Šç‹€æ…‹
                    if (specialSlot) {
                       let label = '';
                       let icon = null;
                       if(specialSlot.type === 'abroad') { label = 'å‡ºåœ‹ (æš«åœé ç´„)'; icon = <Icons.PlaneReal size={20} className="text-stone-400"/>; }
                       if(specialSlot.type === 'rest') { label = 'æœ¬æ—¥ä¼‘æ¯'; icon = <span className="text-lg font-bold text-red-400">ä¼‘</span>; }
                       if(specialSlot.type === 'training') { label = 'é€²ä¿®æ—¥ (æš«åœé ç´„)'; icon = <Icons.PenTool size={18} className="text-indigo-400"/>; }

                       return (
                          <div className="bg-stone-100 border border-stone-200 rounded-xl p-6 flex flex-col items-center justify-center text-stone-500 gap-2">
                             {icon}
                             <span className="font-bold">{label}</span>
                             {isAdmin && <button onClick={() => removeSlot(specialSlot)} className="text-xs text-red-400 underline mt-2">ç§»é™¤æ­¤ç‹€æ…‹</button>}
                          </div>
                       );
                    }
                    
                    // 2. å¦‚æœæœ‰è¨­å®šæ™‚æ®µ (é€šå¸¸æ˜¯æ·¡æ°´)
                    if (currentSlots.length > 0) {
                        return currentSlots.sort((a, b) => a.time.localeCompare(b.time)).map((slot, index) => (
                           <div key={index} className={`bg-white border border-stone-200 rounded-xl p-3 flex justify-between items-center shadow-sm ${slot.status === 'booked' ? 'opacity-60 bg-stone-100' : ''}`}>
                             <div className="flex flex-col">
                               <div className="flex items-center gap-2 text-stone-700 font-bold text-lg">
                                 <Icons.Clock size={16} className="text-[#b07d88]" />
                                 <span className={slot.status === 'booked' ? 'line-through text-stone-400' : ''}>{slot.time}</span>
                                 {slot.status === 'booked' && <span className="bg-stone-500 text-white text-[10px] px-2 rounded-full">å·²é ç´„</span>}
                               </div>
                               <div className="flex items-center gap-2 text-stone-500 text-xs mt-1">
                                 <Icons.MapPin size={12} className={locationColors[slot.location]?.replace('bg-', 'text-') || 'text-stone-400'} />{slot.location}
                               </div>
                               {isAdmin && slot.status === 'booked' && <div className="text-xs text-[#b07d88] font-bold mt-1">å®¢ï¼š{slot.clientName}</div>}
                             </div>
                             {isAdmin ? (
                               <div className="flex gap-2">
                                 {slot.status === 'open' && <button onClick={() => handleAdminBook(slot)} className="bg-green-50 text-green-600 p-2 rounded-lg text-xs font-bold">ç™»è¨˜</button>}
                                 {slot.status === 'booked' && <button onClick={() => updateSlotStatus(slot, 'open')} className="bg-yellow-50 text-yellow-600 p-2 rounded-lg text-xs font-bold">å–æ¶ˆ</button>}
                                 <button onClick={() => removeSlot(slot)} className="bg-red-50 text-red-500 p-2 rounded-lg"><Icons.Trash2 size={16} /></button>
                               </div>
                             ) : (
                               slot.status === 'open' ? 
                               <button onClick={() => handleUserClick(slot)} className="bg-[#fae8eb] text-[#b07d88] px-4 py-2 rounded-lg text-sm font-bold hover:bg-[#dcb5bc] hover:text-white transition">
                                 {slot.type === 'zhubei_notice' ? 'é ç´„/è©¢å•' : 'é ç´„'}
                               </button> :
                               <button disabled className="bg-stone-100 text-stone-400 px-4 py-2 rounded-lg text-sm font-bold">å·²æ»¿</button>
                             )}
                           </div>
                        ));
                    } else {
                        // 3. å¦‚æœæ²’æœ‰è¨­å®šæ™‚æ®µ -> é è¨­é¡¯ç¤ºç«¹åŒ— (è™›æ“¬æ™‚æ®µ)
                        // å»ºç«‹ä¸€å€‹è™›æ“¬ slot ç‰©ä»¶
                        const virtualZhubeiSlot = {
                            id: 'virtual_zhubei',
                            time: 'å…¨æ—¥å¯ç´„',
                            location: 'ç«¹åŒ—è‡ªå®…',
                            status: 'open',
                            isVirtual: true
                        };
                        return (
                           <div className="bg-white border border-yellow-200 rounded-xl p-3 flex justify-between items-center shadow-sm">
                             <div className="flex flex-col">
                               <div className="flex items-center gap-2 text-stone-700 font-bold text-lg">
                                 <Icons.Clock size={16} className="text-yellow-500" />
                                 <span>å…¨æ—¥å¯ç´„ (éœ€å”èª¿)</span>
                               </div>
                               <div className="flex items-center gap-2 text-stone-500 text-xs mt-1">
                                 <Icons.MapPin size={12} className="text-yellow-500" />ç«¹åŒ—è‡ªå®…
                               </div>
                             </div>
                             {isAdmin ? (
                                <div className="text-xs text-stone-400 italic">é è¨­ç«¹åŒ—æ¨¡å¼ (ç„¡å…·é«”æ™‚æ®µ)</div>
                             ) : (
                                <button onClick={() => handleUserClick(virtualZhubeiSlot)} className="bg-yellow-50 text-yellow-600 border border-yellow-200 px-4 py-2 rounded-lg text-sm font-bold hover:bg-yellow-100 transition">
                                  é ç´„/è©¢å•
                                </button>
                             )}
                           </div>
                        );
                    }
                 })()
               }
             </div>
           </div>
           
           {/* é ç´„åˆ—è¡¨ (å«æé†’åŠŸèƒ½ + Googleè¡Œäº‹æ›†åŠŸèƒ½) */}
           {isAdmin && bookedList.length > 0 && (
             <div className="mt-8 border-t-2 border-dashed border-stone-300 pt-6">
               <h3 className="text-center font-bold text-stone-600 mb-4 flex justify-center gap-2">å·²é ç´„åˆ—è¡¨ (å¾…æé†’)</h3>
               <div className="space-y-2">
                 {bookedList.map((slot, i) => (
                   <div key={i} className="bg-stone-50 border border-stone-200 rounded-lg p-3 text-sm flex justify-between items-center">
                     <div>
                       <div className="font-bold text-stone-700">{slot.date} {slot.time}</div>
                       <div className="text-xs text-stone-500">{slot.location} | å®¢ï¼š{slot.clientName}</div>
                     </div>
                     <div className="flex gap-2">
                       <button onClick={() => addToGoogleCalendar(slot)} className="bg-blue-500 text-white px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1" title="åŠ å…¥ Google è¡Œäº‹æ›†">
                         <Icons.Calendar size={12} /> Google
                       </button>
                       <button onClick={() => sendLineReminder(slot)} className="bg-[#06c755] text-white px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1">
                         <Icons.Send size={12} /> LINE
                       </button>
                     </div>
                   </div>
                 ))}
               </div>
             </div>
           )}
           <BookingModal isOpen={modalOpen} onClose={() => setModalOpen(false)} slot={selectedSlot} dateKey={selectedDateKey} />
        </div>
      );
    };

    // ... (PriceItem, AccordionItem, App, root render åŒä¸Š) ...
    // --- ä¸»ç¨‹å¼æ¶æ§‹ ---
    const PriceItem = ({ name, price, desc }) => (
      <div className="flex justify-between items-baseline border-b border-dotted border-stone-300 pb-2 last:border-0">
        <div className="flex flex-col"><span className="font-medium text-stone-700 text-base">{name}</span>{desc && <span className="text-xs text-stone-400 mt-0.5">{desc}</span>}</div>
        <span className="font-bold text-[#b07d88] text-lg shrink-0 ml-4">{price}</span>
      </div>
    );

    const AccordionItem = ({ q, a }) => {
      const [isOpen, setIsOpen] = React.useState(false);
      return (
        <div className="border-2 border-stone-200 rounded-2xl bg-white overflow-hidden transition-all duration-300">
          <button onClick={() => setIsOpen(!isOpen)} className="w-full flex justify-between items-center p-4 text-left hover:bg-stone-50 transition">
            <div className="flex items-center gap-3"><span className="bg-[#dcb5bc] text-white text-xs font-bold px-2 py-1 rounded-full">Q</span><span className="font-medium text-stone-700">{q}</span></div>
            {isOpen ? <Icons.ChevronUp className="text-stone-400 w-5 h-5" /> : <Icons.ChevronDown className="text-stone-400 w-5 h-5" />}
          </button>
          {isOpen && <div className="px-4 pb-4 pt-0 text-sm text-stone-500 leading-relaxed border-t border-stone-100"><div className="mt-3 flex gap-3"><span className="text-[#b07d88] font-bold text-lg leading-none mt-[-2px]">A.</span><span>{a}</span></div></div>}
        </div>
      );
    };

    // === ä¸»æ‡‰ç”¨ç¨‹å¼ (å·²ä¿®æ­£é‡è¤‡å•é¡Œ) ===
    function App() {
      const [isMenuOpen, setIsMenuOpen] = React.useState(false);
      const [activeTab, setActiveTab] = React.useState('price');
      // --- ä¿®æ”¹é–‹å§‹ï¼šæ–°çš„ç‹€æ…‹ç®¡ç† ---
      const [isAdmin, setIsAdmin] = React.useState(false);
      const [showAdminLogin, setShowAdminLogin] = React.useState(false);
      const [adminEmailInput, setAdminEmailInput] = React.useState(''); // æ–°å¢ Email è¼¸å…¥
      const [adminPassword, setAdminPassword] = React.useState('');
      const [loadingAuth, setLoadingAuth] = React.useState(true);
      const [isLookupOpen, setIsLookupOpen] = React.useState(false);
      
      // è¨­å®šæ‚¨çš„ç®¡ç†å“¡ Email (å¿…é ˆè·Ÿ Firebase Console è¨­çš„ä¸€æ¨£)
      const ADMIN_EMAIL = "bianca.studio2026@gmail.com"; 

      React.useEffect(() => {
        // ç›£è½ç™»å…¥ç‹€æ…‹æ”¹è®Š
        const unsubscribe = onAuthStateChanged(auth, (user) => {
          if (user) {
            // å¦‚æœç™»å…¥çš„ä½¿ç”¨è€… Email ç­‰æ–¼æ‚¨çš„ç®¡ç†å“¡ Emailï¼Œå°±æ˜¯ç®¡ç†å“¡æ¨¡å¼
            if (user.email === ADMIN_EMAIL) {
              setIsAdmin(true);
            } else {
              setIsAdmin(false);
            }
          } else {
            // å¦‚æœæ²’æœ‰ä½¿ç”¨è€… (ä¾‹å¦‚å‰›ç™»å‡º)ï¼Œè‡ªå‹•åŸ·è¡ŒåŒ¿åç™»å…¥ï¼Œç¢ºä¿å®¢äººåŠŸèƒ½æ­£å¸¸
            signInAnonymously(auth).catch(console.error);
            setIsAdmin(false);
          }
          setLoadingAuth(false);
        });
        return () => unsubscribe();
      }, []);

      // è™•ç†ç®¡ç†å“¡ç™»å…¥
      const handleAdminLogin = async () => {
        if (!adminEmailInput || !adminPassword) return alert("è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼");
        try {
          await signInWithEmailAndPassword(auth, adminEmailInput, adminPassword);
          setShowAdminLogin(false);
          setAdminPassword(''); // æ¸…ç©ºå¯†ç¢¼æ¬„ä½
          alert("ç®¡ç†å“¡ç™»å…¥æˆåŠŸï¼");
        } catch (error) {
          console.error(error);
          alert("ç™»å…¥å¤±æ•—ï¼šå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
        }
      };

      // è™•ç†ç™»å‡º (è®Šå›ä¸€èˆ¬å®¢äººæ¨¡å¼)
      const handleAdminLogout = async () => {
        await signOut(auth);
        alert("å·²ç™»å‡ºç®¡ç†æ¨¡å¼");
      };
      // --- ä¿®æ”¹çµæŸ ---

      const scrollToSection = (id) => { setActiveTab(id); setIsMenuOpen(false); const element = document.getElementById(id); if (element) element.scrollIntoView({ behavior: 'smooth' }); };

      const openLookup = () => {
        setIsLookupOpen(true);
        setIsMenuOpen(false); // é—œé–‰é¸å–®
      };

      return (
        <div className="min-h-screen bg-[#fdfbf7] font-sans selection:bg-pink-100 pb-20">
          <nav className="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-sm border-b-2 border-dashed border-stone-200">
            <div className="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
              <div className="flex items-center gap-2" onClick={() => window.scrollTo({top: 0, behavior: 'smooth'})}>
                <DoodleEye className="w-8 h-6 text-stone-600" /><span className="font-bold text-lg tracking-wider text-stone-600">Bianca_eye</span>
              </div>
              <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 text-stone-600 hover:bg-stone-100 rounded-full transition">{isMenuOpen ? <Icons.X size={24} /> : <Icons.Menu size={24} />}</button>
            </div>
            {isMenuOpen && (
              <div className="absolute top-16 left-0 right-0 bg-white border-b-2 border-stone-200 shadow-lg p-4 animate-in slide-in-from-top-2">
                <div className="flex flex-col gap-4 items-center">
                  {[{id:'price',label:'åƒ¹ç›®è¡¨'},{id:'policy',label:'é ç´„é ˆçŸ¥'},{id:'qa',label:'Q&A'},{id:'booking',label:'é ç´„æ–¹å¼'}].map(item => (
                    <button key={item.id} onClick={() => scrollToSection(item.id)} className={`text-lg font-medium tracking-wide w-full py-2 text-center rounded-xl transition ${activeTab === item.id ? 'bg-stone-100 text-[#b07d88]' : 'text-stone-500'}`}>{item.label}</button>
                  ))}
                  <button onClick={openLookup} className="text-lg font-bold tracking-wide w-full py-2 text-center rounded-xl transition text-stone-600 border-2 border-[#dcb5bc] bg-[#fff5f7]">
                    <span className="flex items-center justify-center gap-2"><Icons.Search size={18} /> é ç´„æŸ¥è©¢</span>
                  </button>
                </div>
              </div>
            )}
          </nav>

          <header className="pt-28 pb-12 px-4 text-center max-w-md mx-auto">
            <div className="relative inline-block"><h1 className="text-3xl font-bold text-stone-600 mb-2 tracking-widest">Bianca_eye.studio</h1><Icons.Sparkles className="absolute -top-6 -right-6 w-6 h-6 text-yellow-400 animate-pulse" /><SquiggleLine className="w-32 h-4 text-[#dcb5bc] mx-auto" /></div>
            <p className="mt-4 text-stone-500 font-medium tracking-wide">å°ˆå±¬å¦³çš„ç«æ¯›ç®¡ç†å®¤ <br/><span className="text-sm">æ‰“é€ è‡ªç„¶ã€è¼•ç›ˆã€æœ‰ç¥çš„é›™çœ¼</span></p>
          </header>

          <main className="max-w-md mx-auto px-4 space-y-16">
            <section id="price" className="scroll-mt-24">
              <div className="flex items-center gap-2 mb-6 justify-center"><Icons.Star className="w-5 h-5 text-[#dcb5bc]" fill="#dcb5bc" /><h2 className="text-xl font-bold text-stone-600">Service Menu</h2><Icons.Star className="w-5 h-5 text-[#dcb5bc]" fill="#dcb5bc" /></div>
              <div className="space-y-4">
                <HandDrawnBorder className="relative overflow-hidden">
                   <div className="absolute top-0 right-0 w-16 h-16 bg-[#fae8eb] rounded-bl-full -mr-8 -mt-8 z-0"></div>
                   <div className="relative z-10">
                    <h3 className="text-lg font-bold text-[#b07d88] mb-4 flex items-center gap-2"><Icons.Heart size={16} /> åŸç”Ÿç¿¹ç«</h3>
                    <div className="space-y-3">
                      <PriceItem name="ä¸Šç«æ¯›ç®¡ç†" price="$999" desc={<span><span className="text-[#b07d88] font-bold">é¦–æ¬¡é«”é©—åƒ¹ $699</span><br/>å«ç«æ¯›æ³¡æ³¡æ´— + æ»‹é¤Šä¿®è­·</span>} />
                      <PriceItem name="ä¸‹ç«æ¯›ç®¡ç†" price="$500" desc="æ­é…ä¸Šç«æ¯›å„ªæƒ  $300" />
                      <div className="pt-3 border-t border-dashed border-stone-200 mt-1"><div className="flex justify-between items-baseline mb-2"><span className="font-medium text-stone-700 text-base">åŠ è³¼æ¿ƒé»‘é¤Šè­·</span></div><div className="text-xs text-stone-500 space-y-1.5 pl-2 border-l-2 border-[#dcb5bc]/30"><div className="flex justify-between items-center"><span>ä¸Šç«æ¯›</span> <span className="text-stone-400">+$200</span></div><div className="flex justify-between items-center"><span>ä¸‹ç«æ¯›</span> <span className="text-stone-400">+$100</span></div><div className="flex justify-between items-center bg-[#fae8eb]/50 rounded px-1 -mx-1 py-0.5"><span className="text-[#b07d88] font-medium">ä¸Šä¸‹ç«æ¯›ä¸€èµ·</span> <span className="text-[#b07d88] font-bold">+$250</span></div></div></div>
                    </div>
                   </div>
                </HandDrawnBorder>
                <HandDrawnBorder>
                  <h3 className="text-lg font-bold text-[#b07d88] mb-4 flex items-center gap-2"><Icons.Heart size={16} /> é‡ç”Ÿçœ‰é›•å¡‘</h3>
                  <div className="space-y-3">
                    <PriceItem name="é‡ç”Ÿçœ‰é›•å¡‘" price="$999" desc={<span className="text-[#b07d88] font-bold">é¦–æ¬¡é«”é©—åƒ¹ $699</span>} />
                    <div className="mt-2 bg-[#fff5f7] border border-[#dcb5bc] rounded-lg p-3 text-center transform -rotate-1"><span className="block text-sm text-stone-600 font-medium mb-1">âœ¨ è®Šç¾çµ„åˆ âœ¨</span><div className="text-stone-500 text-xs">ç«æ¯›ç®¡ç† + é‡ç”Ÿçœ‰é›•å¡‘</div><div className="text-[#b07d88] font-bold text-lg mt-0.5">åˆè³¼ç¾æŠ˜ $100</div></div>
                  </div>
                </HandDrawnBorder>
                <div className="relative mt-4 mx-2"><div className="absolute -top-4 -left-3 transform -rotate-12"><Icons.Sparkles className="w-8 h-8 text-[#dcb5bc] fill-[#fae8eb]" /></div><div className="border-2 border-dashed border-[#dcb5bc] rounded-2xl bg-white p-4 text-center shadow-sm"><p className="text-stone-500 font-medium mb-1">å—å¤ äº†ç«æ¯›å¤¾ï¼Ÿ</p><div className="text-[#b07d88] font-bold text-xl">8é€±å…§å›è¨ªçºŒä½œï¼Œç¾æŠ˜ $100</div></div></div>
                <div className="relative mt-4 mx-2"><div className="absolute -top-3 -right-2 transform rotate-12"><Icons.Star className="w-8 h-8 text-yellow-400 fill-yellow-400 drop-shadow-sm" /></div><div className="border-2 border-dashed border-[#dcb5bc] rounded-2xl bg-white p-4 text-center shadow-sm"><h3 className="font-bold text-[#b07d88] text-lg mb-2 flex justify-center items-center gap-2"><Icons.Heart className="w-4 h-4 fill-[#b07d88]" /> å¤§æ–¹åˆ†äº«ï¼Œäº«å„ªæƒ  <Icons.Heart className="w-4 h-4 fill-[#b07d88]" /></h3><p className="text-stone-600 text-sm mb-1">ç¤¾ç¾¤åˆ†äº«(é™å‹•/è²¼æ–‡) + æ¨™è¨»</p><div className="inline-block bg-[#b07d88] text-white px-3 py-1 rounded-full text-sm font-bold mt-1 transform -rotate-2">ç•¶æ¬¡ç¾æŠ˜ $50</div></div></div>
              </div>
            </section>

            <section id="policy" className="scroll-mt-24">
              <div className="flex items-center gap-2 mb-6 justify-center"><h2 className="text-xl font-bold text-stone-600">Notice</h2></div>
              <div className="bg-[#f0ecec] p-6 rounded-[2rem] relative">
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-24 h-6 bg-[#dcb5bc]/60 rotate-2"></div>
                <h3 className="text-center font-bold text-stone-600 mb-4">é ç´„å‰è«‹è©³é–±</h3>
                <ul className="space-y-3 text-sm text-stone-600 leading-relaxed list-none">
                  {[
                    "é ç´„è«‹ä¿ç•™ <strong>2-2.5 å°æ™‚</strong> çš„æ“ä½œæ™‚é–“ï¼Œè«‹å‹¿è¶•æ™‚é–“ã€‚",
                    "ç•¶å¤©è«‹ç´ çœ¼å‰ä¾†ï¼Œè‹¥æœ‰çœ¼å¦éœ€å¸é™¤å°‡é…Œæ”¶ <strong class='text-red-400'>$100 æ¸…æ½”è²»</strong>ã€‚",
                    "é²åˆ°è¶…é <strong>15åˆ†é˜</strong> è‡ªå‹•å–æ¶ˆé ç´„ï¼Œä¸å¦è¡Œé€šçŸ¥ã€‚",
                    "è‹¥éœ€æ›´æ”¹é ç´„è«‹ <strong>2å¤©å‰</strong> å‘ŠçŸ¥ï¼Œç„¡æ•…æœªåˆ°è€…å°‡åˆ—å…¥é»‘åå–®ã€‚",
                    "çœ¼ç›è¿‘æœŸæœ‰é–‹åˆ€ã€é›·å°„æˆ–éæ•ç™¼ç‚è€…ï¼Œè«‹äº‹å…ˆå‘ŠçŸ¥ã€‚"
                  ].map((text, i) => (
                    <li key={i} className="flex gap-2"><span className="text-[#dcb5bc] font-bold">{i+1}.</span><span dangerouslySetInnerHTML={{__html: text}}></span></li>
                  ))}
                </ul>
              </div>
            </section>

            <section id="qa" className="scroll-mt-24">
              <div className="flex items-center gap-2 mb-6 justify-center"><h2 className="text-xl font-bold text-stone-600">Q & A</h2></div>
              <div className="space-y-3">
                <AccordionItem q="1. ç¿¹ç«ç®¡ç†/é‡ç”Ÿçœ‰é›•å¡‘å¯ä»¥ç¶­æŒå¤šä¹…ï¼Ÿ" a="æ¯å€‹äººçš„æ¯›é«®ç”Ÿé•·é€±æœŸèˆ‡ä¿é¤Šç¿’æ…£ä¸åŒã€‚ä¸€èˆ¬ä¾†èªªï¼Œç¿¹ç«ç®¡ç†ç´„å¯ç¶­æŒ 4-8 é€±ï¼›é‡ç”Ÿçœ‰é›•å¡‘ç´„å¯ç¶­æŒ 4-6 é€±ã€‚" />
                <AccordionItem q="2. ç«æ¯›ç®¡ç†è·Ÿè§’è›‹ç™½æ˜¯ä¸€æ¨£çš„å—ï¼Ÿ" a="é›–ç„¶åŸç†ç›¸ä¼¼ï¼Œä½†ä½¿ç”¨çš„ç”¢å“èˆ‡æŠ€è¡“å¤§ä¸åŒå–”ï¼å‚³çµ±è§’è›‹ç™½è¼ƒå®¹æ˜“é€ æˆç«æ¯›ä¹¾æ¾€ï¼›Bianca çš„ã€Œç«æ¯›ç®¡ç†ã€ä½¿ç”¨æº«å’Œä¸”å«é«˜ä¿é¤Šæˆåˆ†çš„ç”¢å“ï¼Œåœ¨èª¿æ•´æ¯›æµæ²åº¦çš„åŒæ™‚ï¼ŒåŒæ­¥çµ¦äºˆç«æ¯›æ»‹é¤Šä¿®è­·ï¼Œæ›´åŠ å®‰å…¨ä¸å‚·ç«æ¯›ã€‚" />
                <AccordionItem q="3. ç«æ¯›ç®¡ç†å¾Œæ˜¯ä¸æ˜¯ç«æ¯›æ¯”è¼ƒè„†å¼±æ˜“æ–·ï¼Ÿ" a="ä¸æœƒçš„ã€‚å› ç‚ºæˆ‘å€‘é¸ç”¨çš„ç”¢å“å«æœ‰è§’è›‹ç™½èˆ‡ä¿æ¿•æˆåˆ†ï¼Œæ“ä½œéç¨‹æº«å’Œã€‚åªè¦æ“ä½œæ­£ç¢ºï¼Œä¸¦ä¸æœƒå°è‡´ç«æ¯›è®Šè„†å¼±ã€‚åè€Œå› ç‚ºæ¯›æµæ•´é½Šäº†ï¼Œè¦–è¦ºä¸Šæœƒè¦ºå¾—ç«æ¯›æ›´å¼·éŸŒå¥åº·ã€‚" />
                <AccordionItem q="4. ç‚ºä»€éº¼ä¸€æ®µæ™‚é–“å¾Œï¼Œç«æ¯›æœƒçœ‹èµ·ä¾†å‡Œäº‚ï¼Œæ˜¯å—æå—ï¼Ÿ" a="é€™ä¸æ˜¯å—æå–”ï¼é€™æ˜¯å› ç‚ºç«æ¯›æœ‰ã€Œç”Ÿé•·é€±æœŸã€ã€‚æ–°é•·å‡ºä¾†çš„ç›´ç«æ¯›ï¼ˆåŸç”Ÿç«æ¯›ï¼‰èˆ‡åŸæœ¬åšéæ²ç¿¹ç®¡ç†çš„ç«æ¯›æ··åœ¨ä¸€èµ·ï¼Œäº¤éŒ¯æ’åˆ—ä¸‹æ‰æœƒçœ‹èµ·ä¾†å‡Œäº‚ã€‚é€™æ™‚å€™åªè¦é ç´„å›ä¾†é‡æ–°æ•´ç†ï¼Œå°±èƒ½æ¢å¾©å®Œç¾æ²åº¦å›‰ï¼" />
                <AccordionItem q="5. ç«æ¯›ç®¡ç†å¯ä»¥è®“ç«æ¯›è®Šå¥åº·ï¼Œè®Šé•·å—ï¼Ÿ" a="ç«æ¯›ç®¡ç†ä¸»è¦æ˜¯é€éèª¿æ•´æ¯›æµæ–¹å‘èˆ‡æ²åº¦ï¼Œè®“ç«æ¯›åœ¨è¦–è¦ºä¸Šçœ‹èµ·ä¾†ã€Œè®Šé•·ã€è®Šç¿¹ã€è®Šæ¿ƒå¯†ã€ï¼Œå°±åƒåˆ·äº†ç«æ¯›è†ä¸€æ¨£æœ‰ç¥ã€‚è‹¥å¸Œæœ›åŸç”Ÿç«æ¯›æœ¬èº«è®Šé•·ã€è®Šç²—å£¯ï¼Œå»ºè­°æ­é…å±…å®¶ä½¿ç”¨çš„ã€Œç«æ¯›å¢é•·æ¶²ã€å‹¤å‹ä¿é¤Šå–”ï¼" />
                <AccordionItem q="6. å›å»å¾Œæ€éº¼ä¿é¤Šï¼Ÿ" a="æ–½ä½œå¾Œ 24 å°æ™‚å…§è«‹ä¿æŒä¹¾ç‡¥ã€å‹¿ç¢°æ°´ã€‚æ—¥å¸¸æ´—è‡‰å¾Œï¼Œå»ºè­°ä½¿ç”¨å†·é¢¨å°‡ç«æ¯›å¹ä¹¾ï¼Œä¸¦ä½¿ç”¨ç«æ¯›æ¢³é †è‘—æ¯›æµæ¢³ç†ï¼›å¹³æ™‚æ•´ç†ä¹Ÿå¯ä»¥æ­é…ã€Œç«æ¯›é›¨è¡£ã€åšé€ å‹ï¼Œå°±èƒ½ç¶­æŒæ¼‚äº®çš„æ²åº¦å›‰ï¼" />
              </div>
            </section>

            <section id="booking" className="scroll-mt-24 mb-12">
               <div className="flex items-center gap-2 mb-6 justify-center"><h2 className="text-xl font-bold text-stone-600">Contact & Booking</h2></div>
               <HandDrawnBorder className="mb-8">
                <h3 className="text-[#b07d88] font-bold text-center mb-4 flex justify-center items-center gap-2"><Icons.Calendar size={20} /> æŸ¥çœ‹å¯é ç´„æ™‚æ®µ</h3>
                <p className="text-xs text-stone-500 text-center mb-4">é»æ“Šæ—¥æœŸæŸ¥çœ‹æ™‚æ®µï¼Œé»æ“Šã€Œé ç´„ã€å¯ç›´æ¥è¤‡è£½è¨Šæ¯</p>
                <CalendarView isAdmin={isAdmin} user={auth.currentUser} />
              </HandDrawnBorder>
              <HandDrawnBorder className="text-center !bg-[#fae8eb] !border-[#dcb5bc]">
                <h3 className="text-[#b07d88] font-bold text-lg mb-4">â™¡ ç°¡å–® 3 æ­¥é©Ÿå®Œæˆé ç´„ â™¡</h3>
                <div className="text-left bg-white/60 rounded-xl p-4 mb-6 text-sm text-stone-600 space-y-2 inline-block w-full">
                   <p><span className="font-bold text-[#b07d88]">1.</span> æŸ¥çœ‹ä¸Šæ–¹æ—¥æ›†ï¼ŒæŒ‘é¸é©åˆçš„æ™‚æ®µ</p>
                   <p><span className="font-bold text-[#b07d88]">2.</span> é»æ“Šè©²æ™‚æ®µçš„ã€Œé ç´„ã€æŒ‰éˆ•ï¼Œ<span className="text-[#b07d88]">è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼</span></p>
                   <p><span className="font-bold text-[#b07d88]">3.</span> è·³è½‰è‡³ LINE è²¼ä¸Šè¨Šæ¯ï¼Œå®Œæˆé ç´„ï¼</p>
                   <p className="text-center font-bold text-[#b07d88] pt-2">âœ¨ ç³»çµ±æœƒè‡ªå‹•å¹«æ‚¨è¨ˆç®—æ–°å®¢å„ªæƒ å–”ï¼</p>
                </div>
                <div className="flex flex-col gap-4">
                  <a href="https://lin.ee/49zZehk" target="_blank" rel="noreferrer" className="flex items-center justify-center gap-3 bg-white text-stone-700 py-3 rounded-xl shadow-sm border-2 border-transparent hover:border-[#dcb5bc] transition group"><Icons.MessageCircle className="w-6 h-6 text-[#06c755]" /><span className="font-bold">é»æ­¤åŠ å…¥ LINE é ç´„</span><span className="text-xs text-stone-400 font-normal">@bianca_eye</span></a>
                  <a href="https://www.instagram.com/bianca_eye.studio?igsh=aTl5N21sdmdjNjQ0&utm_source=qr" target="_blank" rel="noreferrer" className="flex items-center justify-center gap-3 bg-white text-stone-700 py-3 rounded-xl shadow-sm border-2 border-transparent hover:border-[#dcb5bc] transition group"><Icons.Instagram className="w-6 h-6 text-[#E1306C]" /><span className="font-bold">Instagram ä½œå“é›†</span></a>
                </div>
                <p className="mt-6 text-xs text-stone-500">* è¨Šæ¯å›è¦†æ™‚é–“ï¼šæœ‰ç©ºæª”å³å›è¦†ï¼ <br/>* å·¥ä½œä¸­ã€å¸¶å°å­©ï¼Œç„¡æ³•å›è¦†ï¼Œè«‹è€å¿ƒç­‰å€™â¤ï¸</p>
              </HandDrawnBorder>
            </section>
          </main>

          {/* [æ–°å¢] æ¸²æŸ“é ç´„æŸ¥è©¢è¦–çª— */}
          <ReservationLookupModal isOpen={isLookupOpen} onClose={() => setIsLookupOpen(false)} />

          <footer className="bg-stone-100 py-8 text-center text-stone-400 text-sm">
            <DoodleEye className="w-6 h-4 mx-auto mb-2 opacity-50" />
            <p>&copy; 2024 Bianca_eye.studio</p>
            <p className="text-xs mt-1">Design for Beauty</p>
            
            {/* --- Footer çš„ç™»å…¥å€å¡Š --- */}
            <div className="mt-8 pt-4 border-t border-stone-200 w-3/4 mx-auto">
              {!isAdmin ? (
                <button onClick={() => setShowAdminLogin(!showAdminLogin)} className="text-[10px] text-stone-300 hover:text-stone-500 transition">
                  Manager Login
                </button>
              ) : (
                <div className="flex flex-col gap-2 items-center">
                   <span className="text-xs text-[#b07d88] font-bold">ç›®å‰ç‚ºç®¡ç†å“¡æ¨¡å¼</span>
                   <button onClick={handleAdminLogout} className="text-[10px] underline text-stone-400">ç™»å‡º (Exit)</button>
                </div>
              )}

              {showAdminLogin && !isAdmin && (
                <div className="mt-4 bg-white p-4 rounded-xl border border-stone-200 shadow-sm max-w-[200px] mx-auto flex flex-col gap-2">
                  <input 
                    type="email" 
                    placeholder="Email" 
                    className="text-xs p-2 border rounded w-full outline-none focus:border-[#dcb5bc]" 
                    value={adminEmailInput} 
                    onChange={(e) => setAdminEmailInput(e.target.value)} 
                  />
                  <input 
                    type="password" 
                    placeholder="Password" 
                    className="text-xs p-2 border rounded w-full outline-none focus:border-[#dcb5bc]" 
                    value={adminPassword} 
                    onChange={(e) => setAdminPassword(e.target.value)} 
                  />
                  <button onClick={handleAdminLogin} className="w-full py-2 bg-[#dcb5bc] text-white rounded-lg text-xs font-bold hover:opacity-90">
                    ç™»å…¥
                  </button>
                </div>
              )}
            </div>
            
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>